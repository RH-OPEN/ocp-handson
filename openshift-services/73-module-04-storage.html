<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ストレージ管理 :: OpenShift Handson</title>
    <link rel="canonical" href="https://rh-open.github.io/ocp-handson/openshift-services/73-module-04-storage.html">
    <link rel="prev" href="72-module-02-mtv.html">
    <link rel="next" href="74-module-05-bcdr.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://rh-open.github.io/ocp-handson">OpenShift Handson</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="openshift-services" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">01. OpenShift 基礎</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01_app-mgmt-basics.html">1. コンテナデプロイと管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01_app-deployment.html">2. Web コンソールの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02_app-storage-basics.html">3. 永続ストレージ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03_machinesets.html">4. ノードの動的管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04_infra-nodes.html">5. Infra ノードの作成</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06_template-quota-limits.html">6. Project のクオータ/制限</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07_clusterresourcequota.html">7. クラスタのクオータ設定</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">20. OpenShift Pipeline Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-pipeline-install.html">インストール</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-pipelines.html">1. Pipelines -1/2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-add-task.html">2. Pipelines -2/2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13-triggers.html">3. Tekton Triggers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">21. OpenShift GitOps Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20-GitOps-install.html">インストール</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="21-GitOps.html">1. OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="22-Kustomize.html">2. Kustomizeインテグレーション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="23-Helm.html">3. Helmインテグレーション</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">51. Red Hat OpenShift Service on AWS (ROSA) Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="50-rosa-info.html">0. はじめに</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="51-rosa-hcp-create.html">1. ROSA HCPクラスターの作成 [デモ]</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="52-rosa-app-deploy.html">2. サンプルアプリケーションのデプロイ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="53-rosa-ebs.html">3. Amazon EBSの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="54-1-rosa-web-terminal.html">4. Web Terminalの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="54-2-rosa-dev-spaces.html">5. Web IDEを利用した開発</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="58-rosa-bedrock.html">6. Amazon Bedrockアプリケーションの実行</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-1-rosa-log-01.html">7. ロギング設定 [デモ]</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-1-rosa-log-02.html">8. OpenShiftコンソールでのログ確認</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-2-rosa-monitoring.html">9. モニタリング</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-3-rosa-project-metrics.html">10. プロジェクトのメトリクスデータの確認</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-4-rosa-alert.html">11. アラート設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="56-rosa-nodes.html">12. ワーカーノードの追加と削除</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="57-rosa-upgrade.html">13. ROSA HCPクラスターの更新</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">61. Azure Red Hat OpenShift (ARO) Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="60-aro-info.html">0. はじめに</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="61-aro-create.html">1. AROクラスターの作成 [デモ]</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="62-aro-app-deploy.html">2. サンプルアプリケーションのデプロイ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="63-aro-storage.html">3. Azure DiskとAzure Filesの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="64-aro-web-terminal.html">4. Web Terminalの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="65-aro-dev-spaces.html">5. Web IDEを利用した開発</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="66-aro-logging.html">6. ロギング</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="67-1-aro-monitoring.html">7. モニタリング</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="67-2-aro-project-metrics.html">8. プロジェクトのメトリクスデータの確認</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="67-3-aro-alert.html">9. アラート設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="68-aro-nodes.html">10. ワーカーノードの追加と削除</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="69-aro-upgrade.html">11. AROクラスターの更新[デモ]</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">71. OpenShift Virtualization Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="70-index.html">0. はじめに</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="71-module-01-intro.html">1. 仮想マシン管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="72-module-02-mtv.html">2. 既存の仮想マシンの移行</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="73-module-04-storage.html">3. ストレージ管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="74-module-05-bcdr.html">4. 仮想マシンのバックアップとリカバリ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="75-module-07-tempinst.html">5. テンプレートとインスタンスタイプの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="76-module-08-workingvms.html">6. 仮想マシンとアプリケーションの操作</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="78-module-09-networking.html">7. 仮想マシンのネットワーク管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="79-conclusion.html">8. 追加情報</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">81. Day 2 Operations and Automation with OpenShift Virtualization</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="80-index.html">0. はじめに</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="81-module-01-day-to-day.html">1. 日々の基本的な操作の有効化</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="82-module-02-real-world-scaling.html">2. 実環境でのスケーリングシナリオ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="83-module-03-to-the-moon.html">3. 無限の可能性へ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="84-conclusion.html">4. 追加情報</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OpenShift Handson</a></li>
    <li>71. OpenShift Virtualization Lab</li>
    <li><a href="73-module-04-storage.html">3. ストレージ管理</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/RH-OPEN/ocp-handson/edit/master/documentation/modules/ROOT/pages/73-module-04-storage.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">ストレージ管理</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat OpenShift は、オンプレミスおよびクラウドプロバイダーの両方で、複数の種類のストレージをサポートしています。OpenShift 仮想化は、ワークロードが実行されている環境でサポートされているコンテナストレージインターフェイス（CSI）プロビジョナーを使用できます。</p>
</div>
<div class="paragraph">
<p>物理ストレージシステムの例としては、Dell/EMC、富士通、日立、NetApp、Pure Storage などがあります。</p>
</div>
<div class="paragraph">
<p>ソフトウェア定義ストレージの例としては、IBM Fusion Data Foundation、OpenShift Data Foundation (ODF)、Portworx などがあります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
このリストは完全なものではありません。サポート対象のストレージソリューションのすべての情報については、 <a href="https://catalog.redhat.com/platform/red-hat-openshift/virtualization#virtualization-infrastructure" target="_blank" rel="noopener">Red Hat EcoSystem Catalog</a> を参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このラボでは、プロバイダーにストレージを要求し、VMディスクを保存するために使用されるPVC（Persistent Volume Claim）について説明します。多くのストレージプロバイダーは、デバイスのスナップショットやクローンもサポートしています。CSIドライバーとストレージデバイスがサポートする機能については、必ずベンダーに確認してください。</p>
</div>
<div class="paragraph">
<p>特に、OpenShift Virtualization固有のストレージプロトコル（NFS、iSCSI、FCなど）に関する制限はありません。唯一の要件は、クラスタ内のVMのライブマイグレーションをサポートするために必要な <strong>RWXアクセスモード</strong> が利用可能であることです。それ以外では、組織のVMとアプリケーションのニーズに最も適したストレージを選択することが適切です。</p>
</div>
<div class="paragraph">
<p>Red Hat OpenShift でストレージをプロビジョニングする際の CSI ワークフローのデモについては、以下の図を参照してください。</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/00_Disk_Concepts.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/00_Disk_Concepts.png" alt="00 Disk Concepts" width="100%"></a>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examine_pvc"><a class="anchor" href="#examine_pvc"></a>VM の PVC を確認する</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このラボでは、先ほど作成した仮想マシン <strong>fedora01</strong> のバックエンドストレージを詳しく見ていきます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>左側のメニューで <strong>Storage</strong> &#8594; <strong>Persistent Volume Claims</strong> をクリックして開始します。 <strong>vmexamples-{user}</strong> ネームスペースにいることを確認してください。前のセクションで <strong>fedora01</strong> 仮想マシンを作成したときに作成された <strong>fedora01</strong> PVCが表示されるはずです。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/01_PVC_List.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/01_PVC_List.png" alt="01 PVC List" width="100%"></a>
</div>
</div>
</li>
<li>
<p><strong>fedora01</strong> PVCをクリックすると、VMをバックアップするストレージボリュームに関する追加の詳細情報が表示されます。</p>
</li>
<li>
<p>PVCに関する以下の情報に注目してください:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>PVCは現在、正常にバインドされています</p>
</li>
<li>
<p>PVCは30GiBの容量とサイズを要求しています</p>
</li>
<li>
<p>PVCのアクセスモードはReadWriteMany (RWX) です</p>
</li>
<li>
<p>PVCのボリュームモードはBlockです</p>
</li>
<li>
<p>ボリュームは <strong>ocs-external-storagecluster-ceph-rbd</strong> ストレージクラスを使用しています。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/02_Fedora01_PVC_Details.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/02_Fedora01_PVC_Details.png" alt="02 Fedora01 PVC Details" width="100%"></a>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing_snapshots"><a class="anchor" href="#managing_snapshots"></a>スナップショットの管理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift Virtualizationは、仮想マシンのディスクスナップショットを作成するために、CSIストレージプロバイダーのスナップショット機能に依存しています。スナップショットは、VMが実行中の場合は「オンライン」で、VMの電源がオフの場合は「オフライン」で取得できます。VMにKVM統合パッケージ（qemu-tools）がインストールされている場合、ゲストオペレーティングシステムを自動的に静止させるオプションも利用できます（静止により、ディスクのスナップショットがゲストファイルシステムの整合性のある状態を確実に反映します。例えば、バッファがフラッシュされ、ジャーナルが整合性のある状態になります）。</p>
</div>
<div class="paragraph">
<p>ディスクのスナップショットは、CSIによって抽象化されたストレージ実装に依存するため、パフォーマンスへの影響と使用容量はストレージプロバイダによって異なります。ストレージベンダーと協力して、システムがPVCスナップショットをどのように管理するか、また、期待されるパフォーマンスにどのような影響があるか（または影響がないか）を判断してください。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
スナップショットは、通常、元の物理ボリュームと同じストレージシステム上にローカルに保存されるため、それ自体ではバックアップや災害復旧機能を提供しません。真の災害から生き延びるためには、データを別の方法で保護する必要があります。例えば、1つ以上のコピーを別の場所に保存したり、ストレージシステム自体の故障を回避するために、リモートロケーションのストレージシステムにミラーリングしたりします。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>VMスナップショット機能により、クラスタ管理者およびアプリケーション開発者は、以下の操作を行うことができます:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>新しいスナップショットの作成</p>
</li>
<li>
<p>特定のVMにアタッチされたすべてのスナップショットのリスト表示</p>
</li>
<li>
<p>VMをスナップショットに復元</p>
</li>
<li>
<p>既存のVMスナップショットを削除</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_スナップショットの作成と使用"><a class="anchor" href="#_スナップショットの作成と使用"></a>スナップショットの作成と使用</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Virtualization</strong> パースペクティブドロップダウンに戻り、左側のメニューで <strong>VirtualMachines</strong> をクリックします。 中央列のプロジェクト <strong>vmexamples-{user}</strong> を展開し、<strong>fedora01</strong> 仮想マシンをハイライトします。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/03_VM_Overview.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/03_VM_Overview.png" alt="03 VM Overview" width="100%"></a>
</div>
</div>
</li>
<li>
<p>現在、このVMのスナップショットは概要ページに表示されていないことに注意してください。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/04_Snapshots_Overview.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/04_Snapshots_Overview.png" alt="04 Snapshots Overview" width="100%"></a>
</div>
</div>
</li>
<li>
<p>ページ上部の <strong>Snapshots</strong> タブに移動します。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/05_Snapshot_Menu.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/05_Snapshot_Menu.png" alt="05 Snapshot Menu" width="100%"></a>
</div>
</div>
</li>
<li>
<p><strong>Take snapshot</strong> をクリックすると、ダイアログが開きます。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/06_VM_Snapshot_Dialog.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/06_VM_Snapshot_Dialog.png" alt="06 VM Snapshot Dialog" width="100%"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>cloudinitdisk</strong> がスナップショットに含まれないという警告が表示されます。これは初期ブートに使用される一時的なディスクであるため、想定される動作です。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>スナップショットには自動的に名前が生成されます。 <strong>Save</strong> をクリックし、ステータスが <strong>Operation complete</strong> と表示されるまで待ちます。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/07_VM_Snapshot_Taken.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/07_VM_Snapshot_Taken.png" alt="07 VM Snapshot Taken" width="100%"></a>
</div>
</div>
</li>
<li>
<p>3点のドットメニューをクリックします。VMが現在実行中であるため、<strong>Restore</strong> オプションがグレーアウトされていることを確認します。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/08_VM_Restore_Disabled.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/08_VM_Restore_Disabled.png" alt="08 VM Restore Disabled" width="100%"></a>
</div>
</div>
</li>
<li>
<p>次に、<strong>Console</strong> タブに切り替えます。ログインして、VMが起動できないように変更を加えます。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/09_Console_Login.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/09_Console_Login.png" alt="09 Console Login" width="100%"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>User name</strong> と <strong>Password</strong> の両方の隣にコピーアイコンがあり、<strong>Paste to console</strong> (コンソールに貼り付け)ボタンも利用可能です。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>ログイン後、次のコマンドを実行します。</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">sudo rm -rf /boot/grub2; sudo shutdown -r now</code></pre>
</div>
</div>
</li>
<li>
<p>実行すると、仮想マシンは自動的に再起動しますが、正常に起動することはできなくなります。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/10_Bootloader_Broken.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/10_Bootloader_Broken.png" alt="10 Bootloader Broken" width="100%"></a>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
前のステップでは、ゲスト内でオペレーティングシステムをシャットダウンしました。しかし、VMをホストしているPodがまだ実行中であるため、OpenShift仮想化はデフォルトでポリシーに基づいて自動的に再起動します。この動作は、グローバルまたはVMごとに変更できます。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>右上の <strong>Actions</strong> ドロップダウンメニューまたはショートカットボタンを使用して、VMを <strong>Stop</strong> します。 このプロセスは、マシンが不安定な状態にあるため、正常なシャットダウンを試みるため、時間がかかる場合があります。<strong>Actions</strong> ドロップダウンメニューを再度クリックすると、<strong>Force stop</strong> オプションが表示されます。 ラボを継続するには、このオプションを使用してください。</p>
</li>
<li>
<p><strong>Overview</strong> タブをクリックして、VM が停止したことを確認できます。 また、先ほど取得したスナップショットが <strong>Snapshot</strong> タイルに表示されていることも確認できます。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/11_VM_Stopped_Snapshot.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/11_VM_Stopped_Snapshot.png" alt="11 VM Stopped Snapshot" width="100%"></a>
</div>
</div>
</li>
<li>
<p><strong>Snapshot</strong> タイルで、当社のスナップショットの横にある3つのドットのメニューをクリックします。VMが停止している状態で、<strong>Restore</strong> がグレー表示ではなくなります。クリックします。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/12_VM_Restore.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/12_VM_Restore.png" alt="12 VM Restore" width="100%"></a>
</div>
</div>
</li>
<li>
<p>表示されるダイアログで <strong>Restore</strong> をクリックします。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/13_VM_Restore_Dialog.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/13_VM_Restore_Dialog.png" alt="13 VM Restore Dialog" width="100%"></a>
</div>
</div>
</li>
<li>
<p>VM が復元されるまで待ちます。このプロセスはかなり速く完了します。 上部にある <strong>Snapshots</strong> タブをクリックすると、直近の復元操作の詳細を確認できます。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/14_VM_Restored.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/14_VM_Restored.png" alt="14 VM Restored" width="100%"></a>
</div>
</div>
</li>
<li>
<p><strong>Overview</strong> タブに戻り、VM を起動します。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/15_VM_Start.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/15_VM_Start.png" alt="15 VM Start" width="100%"></a>
</div>
</div>
</li>
<li>
<p><strong>Console</strong> タブをクリックして、VM が再起動し、OS に正常にブートアップしたことを確認します。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/16_VM_Running.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/16_VM_Running.png" alt="16 VM Running" width="100%"></a>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="clone_vm"><a class="anchor" href="#clone_vm"></a>仮想マシンのクローン</h2>
<div class="sectionbody">
<div class="paragraph">
<p>クローニングにより、ストレージとして独自のディスクイメージを使用する新しいVMが作成されますが、クローンの構成および保存データのほとんどはソースVMと同一です。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Overview</strong> 画面に戻り、<strong>Actions</strong> ドロップダウンメニューをクリックしてVMをクローニングするオプションを表示します。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/17_Overview_Actions_Clone.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/17_Overview_Actions_Clone.png" alt="17 Overview Actions Clone" width="100%"></a>
</div>
</div>
</li>
<li>
<p><strong>Actions</strong> メニューから <strong>Clone</strong> をクリックすると、ダイアログが開きます。 複製したVMに <strong>fedora02</strong> という名前を付け、<strong>Start VirtualMachine on clone</strong> のチェックボックスがチェックされていないことを確認してから、<strong>Clone</strong> をクリックします。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/18_VM_Clone_Dialog.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/18_VM_Clone_Dialog.png" alt="18 VM Clone Dialog" width="100%"></a>
</div>
</div>
</li>
<li>
<p>新しいVMが作成され、ディスクが複製され、ポータルが自動的に新しいVMにリダイレクトされます。 <strong>Created</strong> の時間がごく最近であることがわかります。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/19_VM_Cloned.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/19_VM_Cloned.png" alt="19 VM Cloned" width="100%"></a>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
クローンされたVMはソースVMと同じIDを持つため、VMとやり取りするアプリケーションや他のクライアントとの間で競合が発生する可能性があります。外部ネットワークに接続されているVMや同じプロジェクト内のVMをクローンする場合は、注意が必要です。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>画面上部の <strong>YAML</strong> メニューをクリックすると、VMの名前が「<strong>fedora02</strong>」となっていることがわかりますが、ソースVM <strong>fedora01</strong> から残っているラベルがいくつかあり、これらは手動で更新する必要があります。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/20_Cloned_VM_YAML.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/20_Cloned_VM_YAML.png" alt="20 Cloned VM YAML" width="100%"></a>
</div>
</div>
</li>
<li>
<p>YAML内の <strong>app</strong> と <strong>kubevirt.io/domain</strong> の値を <strong>fedora02</strong> に設定し、下部の <strong>Save</strong> ボタンをクリックすると、<strong>fedora02</strong> が新しいバージョンに更新された旨のメッセージが表示されます。この作業を今行うことで、後のモジュールでこのVMを使用する際に問題を回避することができます。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/21_Cloned_VM_YAML_Saved.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/21_Cloned_VM_YAML_Saved.png" alt="21 Cloned VM YAML Saved" width="100%"></a>
</div>
</div>
</li>
<li>
<p>仮想マシンの YAML の変更が完了したら、<strong>fedora01</strong> と <strong>fedora02</strong> の両方を実行するように起動します。</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/virt/2025_spring/module-04-storage/22_Fedora02_Running.png" target="blank"><img src="_images/virt/2025_spring/module-04-storage/22_Fedora02_Running.png" alt="22 Fedora02 Running" width="100%"></a>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_まとめ"><a class="anchor" href="#_まとめ"></a>まとめ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このセクションでは、仮想マシンを管理する際に利用可能なストレージオプションについて説明しました。また、仮想マシンのスナップショットを取得して基本的な復元を行うことや、他のプロジェクトで使用したり、今後の開発を効率化するために仮想マシンのクローンを作成することなど、仮想マシンに用意されたストレージに依存するいくつかのVM管理機能も実行しました。</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="72-module-02-mtv.html">2. 既存の仮想マシンの移行</a></span>
  <span class="next"><a href="74-module-05-bcdr.html">4. 仮想マシンのバックアップとリカバリ</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
